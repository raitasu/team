import{r as x,ai as fe,t as s,X as T,T as A,B as w,aU as es,am as le,aY as ss,Y as R,aE as ge,aa as ee,b7 as ns,b2 as as,aB as _e,P as se,$ as k,b8 as ts,V as d,b9 as os,ba as rs,x as v,aZ as Ie,Z as U,at as ls,as as is,bb as De,ag as Oe,aV as Pe,aj as Fe,aW as ds,b3 as cs,a8 as ms,an as us,b4 as ps}from"./index-7c96dcd7.js";import{I as G,g as Ee,H as hs,a as ne,b as ae,G as z,c as te,T as gs,d as _s,e as xs,f as fs,h as js,_ as bs}from"./WorkExperience.utils-2d29f128.js";import{T as O,F as b,S as I,I as B,A as Ae,c as Be,e as Re,f as Y,h as oe,j as ie,k as Ve,l as Le,u as Ne,g as He,a as Ge,b as ys}from"./index-82eae258.js";import{b as vs,c as Cs,d as Ue,P as ws,e as Ts,f as Ss,g as Ms,h as ks,i as $s,j as Is,k as Ds}from"./ProjectAvatarEditor-78afceec.js";import{g as re,a as Q,G as M,e as je,c as Os,f as qe,b as ze,d as We}from"./dates.utils-434c8e9a.js";import{u as Ps}from"./chunk-RK6YFQX6-a52e6be9.js";import{L as be,C as E,R as Fs,o as D}from"./utils-bd2e33f4.js";import{u as S,b as de,s as ce,B as X,F as me,a as V,c as Ye}from"./index-fd30cd2e.js";import{a as Ze,i as Es,u as Qe}from"./positions.api-b485f978.js";import{T as xe,C as ye,P as As,c as ve}from"./employee.styles-a2c2c3c5.js";import{S as Bs}from"./chunk-O5CRURSQ-cbe1017d.js";import{a as Xe}from"./employees.api-d18e4832.js";import{I as Z}from"./index-517a60f3.js";import{P as Ce}from"./PageContainer-39cf8395.js";import"./identity-53e7f34f.js";import"./_arrayPush-1b12cf12.js";const Rs=({project:e})=>{const[n,{language:a}]=x(),t=e.started_at?re(e.started_at,a,fe.Short):n("domains:employee.errors.no_data"),o=e.ended_at?re(e.ended_at,a,fe.Short):n("domains:projects.status.in_progress"),r=s.jsxs(T,{justifyContent:"center",children:[s.jsx(A,{children:n(`domains:projects.type.${e.project_type}`)}),s.jsx(A,{pl:"3px",children:n("domains:projects.project")})]});return s.jsxs(w,{sx:{"> *:not(:last-child)":{marginBottom:"10px"},"> *":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},textAlign:"center",children:[s.jsx(es,{variant:"4",children:e.name||n("domains:employee.errors.no_data")}),s.jsx(A,{variant:"hr",children:e.customer?e.customer.name:n("domains:employee.errors.no_data")}),s.jsxs(T,{justifyContent:"center",children:[s.jsx(A,{children:`${t} –`}),s.jsx(A,{pl:"3px",children:o})]}),r]})},Vs=({project:e,canEdit:n})=>{const{t:a}=x(),{isOpen:t,onOpen:o,onClose:r}=le(),l=ss(),{onCopy:g}=Ps(document.location.href),h=R(k),[p,{isLoading:m}]=vs(),_=async()=>{try{await p(e.id),l(se.Projects)}catch{h({description:a("domains:global.errors.descriptions.unknown_error")})}};return s.jsxs(T,{flexDirection:"column",gap:"40px",children:[s.jsx(O,{hasArrow:!0,place:"top",labelText:a(`domains:projects.status.${e.status}`),children:s.jsx(ge,{src:e.avatar?`https://team-prod.cybergizer.com${e.avatar}`:void 0,size:"lg",borderRadius:"none",style:{border:`${Cs(e.status)}`}})}),s.jsx(Rs,{project:e}),n&&s.jsxs(T,{flexDirection:"column",gap:"10px",children:[s.jsx(ee,{variant:"primaryOutline",leftIcon:s.jsx(ns,{}),onClick:g,children:a("domains:projects.actions.copy_project")}),s.jsx(ee,{variant:"primaryOutline",leftIcon:s.jsx(as,{}),onClick:o,children:a("domains:projects.actions.delete_project")}),s.jsx(_e,{title:a("domains:projects.actions.delete_project"),description:a("domains:global.confirmations.descriptions.delete_project"),isOpen:t,onClose:r,isLoading:m,onConfirm:async()=>{try{await _(),l(se.Projects)}catch{h({description:a("domains:global.errors.descriptions.unknown_error")})}}})]})]})},Ls=({project:e})=>{const[n]=x();return s.jsx(G,{title:n("domains:employee.titles.profile_tabs.personal_information.general.section_title"),children:`${e.name||"Project"} attachments`})};var Ns=ts,Hs=Ns(function(e,n,a){return e+(a?" ":"")+n.toUpperCase()}),Je=Hs;d.array(d.object({category:os,id:d.number(),name:d.string()})).nullable();const Gs=d.object({overall:d.array(d.number()),frontend:d.array(d.number()),backend:d.array(d.number()),dba:d.array(d.number()),dev_ops:d.array(d.number()),blockchain:d.array(d.number()),management:d.array(d.number()),design:d.array(d.number())}),Us=()=>rs.reduce((e,n)=>(e[n]=[],e),{}),we=e=>(e||[]).reduce((n,a)=>(n[a.category].push(a.id),n),Us()),qs=({hardSkills:e,label:n})=>{const[a]=x(),{field:t}=S({name:n}),o=v.useMemo(()=>e?e.map(l=>({value:l.id,label:l.name})):[],[e]),r=o.filter(l=>t.value.some(g=>g===l.value));return s.jsx(b,{label:a(`domains:employee.titles.profile_tabs.skills.category.${n}`),children:s.jsx(I,{isMulti:!0,placeholder:a("domains:filters.placeholders.placeholder_select"),options:o,value:r,onChange:l=>{t.onChange(l.map(g=>g.value))},size:"md"})})},zs=({project:e,isOpenEnvironmentInfo:n,onCloseEnvironmentInfo:a})=>{const[t]=x(),{data:o}=Ze(),{id:r}=Ie(),[l,{isLoading:g}]=Ue(),h=v.useMemo(()=>Ee(o,"category"),[o]),{hard_skills:p}=e,m=de({defaultValues:we(p),mode:"onBlur",resolver:ce(Gs)}),_=R(k),i=U(k),{reset:c}=m;v.useEffect(()=>{c(we(p),{keepDefaultValues:!1})},[c,p]);const u=async j=>{try{const C=[];Object.entries(j).forEach(P=>C.push(...P[1])),await l({data:{hard_skill_ids:C.length>0?C:[]},id:Number(r)}).unwrap(),a(),i({description:t("domains:global.confirmations.descriptions.saved")})}catch(C){console.error(C),_({description:t("domains:global.errors.descriptions.unknown_error")})}};return s.jsx(X,{autoFocus:!1,title:Je(`${t("domains:employee.titles.profile_tabs.work_experience.environment")}`),isOpen:n,onClose:a,shouldUseOverlay:!0,isCentered:!0,footer:s.jsx(Q,{onCancel:()=>{a(),m.reset()},onReset:()=>m.reset(),isValid:m.formState.isValid,isTouched:m.formState.isDirty,isLoading:g,onSubmit:m.handleSubmit(u),submitTag:"save"}),children:s.jsx(me,{...m,children:s.jsx(T,{gap:"20px",flexDirection:"column",children:Object.keys(h).map(j=>s.jsx(qs,{label:j,hardSkills:h[j]},j))})})})},Ws=({project:e,canEdit:n})=>{const{t:a}=x(),{isOpen:t,onOpen:o,onClose:r}=le(),l=v.useMemo(()=>Ee(e.hard_skills,"category"),[e.hard_skills]),g=Object.keys(l);return s.jsxs(G,{title:`${a("domains:employee.titles.profile_tabs.work_experience.environment")}`,onEdit:n?o:void 0,children:[s.jsx(M,{gap:"30px",children:g.length?g.map(h=>s.jsxs(M,{gridTemplateColumns:`${be} 1fr`,children:[s.jsx(A,{color:"brand.ghostGray",fontWeight:500,variant:"l",children:a(`domains:employee.titles.profile_tabs.skills.category.${h}`)}),s.jsx(M,{gridTemplateColumns:`${be} 1fr`,columnGap:E,rowGap:Fs,children:l[h].map(p=>s.jsx(hs,{skill:p},p.id))})]},h)):s.jsx(G,{style:{gap:0},children:s.jsx(A,{color:"brand.lightGray",children:a("domains:employee.errors.no_data")})})}),s.jsx(zs,{project:e,isOpenEnvironmentInfo:t,onCloseEnvironmentInfo:r})]})},ue=e=>{var n;return{avatar:e.avatar||"",customer_name:((n=e.customer)==null?void 0:n.name)||"",name:e.name||"",status:e.status,project_type:e.project_type,started_at:{month:e.started_at?ne(new Date(e.started_at)).toString():null,year:e.started_at?ae(new Date(e.started_at)).toString():null},ended_at:{year:e.ended_at?ae(new Date(e.ended_at)).toString():null,month:e.ended_at?ne(new Date(e.ended_at)).toString():null},country_id:e.country?e.country.id:null,business_domain:e.business_domain?{label:e.business_domain,value:e.id.toString()}:null,hard_skill_ids:e.hard_skills?e.hard_skills.map(a=>a.id):[],description:e.description||"",challenge:e.challenge||"",solution:e.solution||""}},Ys=({onReset:e})=>{var o;const{field:n,formState:{errors:a}}=S({name:"avatar"}),{field:t}=S({name:"status"});return s.jsx(b,{width:"none",errorMessage:(o=a.avatar)!=null&&o.message?a.avatar.message:void 0,children:s.jsx(ws,{avatar:n.value,status:t.value,onAvatarChanged:r=>{n.onChange(r),n.onBlur()},onReset:e,avatarUrl:n.value})})},Zs=()=>{const[e]=x(),{field:n}=S({name:"business_domain"}),{value:a}=n,t=je.map((r,l)=>({value:String(l),label:e(`enums:business_domains.${r}`)})),o=a?t.find(r=>+r.value===je.findIndex(l=>l===a.label)):null;return s.jsx(b,{label:e("domains:projects.business_domain"),children:s.jsx(I,{placeholder:e("domains:filters.placeholders.placeholder_select"),options:t,value:o,onChange:r=>{r&&n.onChange(r)},size:"md"})})},Qs=()=>{const{register:e}=V(),{t:n}=x();return s.jsx(b,{label:n("domains:projects.challenge"),children:s.jsx(xe,{...e("challenge")})})},Xs=()=>{const{register:e}=V(),{t:n}=x();return s.jsx(b,{label:n("domains:projects.company_name"),children:s.jsx(B,{...e("customer_name")})})},Js=()=>{const[e]=x(),{field:n}=S({name:"country_id"}),a=Os.map((o,r)=>({value:r+1,label:e(`enums:country.${o.value}`)})),t=a.find(o=>o.value===n.value);return s.jsx(b,{label:e("domains:projects.region"),children:s.jsx(I,{placeholder:e("domains:filters.placeholders.placeholder_select"),options:a,value:t,onChange:o=>{o&&n.onChange(o.value)},size:"md"})})},Ks=()=>{var h,p,m,_,i,c;const[e]=x(),{field:n}=S({name:"started_at"}),{field:a}=S({name:"ended_at"}),{register:t,formState:{errors:o},getValues:r}=V(),l=r("started_at.year"),g=r("ended_at.year");return s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(b,{label:e("domains:employee.titles.profile_tabs.education.start_date"),errorMessage:(p=(h=o.started_at)==null?void 0:h.month)!=null&&p.message?e(`general_errors:${o.started_at.month.message}`):void 0,isRequired:!0,children:s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(I,{...n,isClearable:!0,onChange:u=>{n.onChange({year:l,month:u===null?null:String(u.value)})},options:D,getOptionLabel:u=>e(u.label),value:(m=D.find(u=>String(u.value)===String(n.value.month)))!=null?m:null,placeholder:e("general_placeholders:month")}),s.jsx(O,{hasArrow:!0,place:"top",labelText:e("enums:notes.start_year"),children:s.jsx(B,{...t("started_at.year"),onBlur:u=>{u.target.value.trim()===""&&n.onChange({year:null,month:n.value.month}),n.onBlur()},placeholder:e("general_placeholders:year")})})]})}),s.jsx(b,{label:e("domains:employee.titles.profile_tabs.education.end_date"),errorMessage:(i=(_=o.ended_at)==null?void 0:_.month)!=null&&i.message?e(`general_errors:${o.ended_at.month.message}`):void 0,children:s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(I,{...a,isClearable:!0,onChange:u=>{a.onChange({year:g,month:u===null?null:String(u.value)})},options:D,getOptionLabel:u=>e(u.label),value:(c=D.find(u=>String(u.value)===String(a.value.month)))!=null?c:null,placeholder:e("general_placeholders:month")}),s.jsx(O,{hasArrow:!0,place:"top",labelText:e("enums:notes.end_year"),children:s.jsx(B,{...t("ended_at.year"),onBlur:u=>{u.target.value.trim()===""&&a.onChange({year:null,month:a.value.month}),a.onBlur()},placeholder:e("general_placeholders:year")})})]})})]})},en=()=>{const{register:e}=V(),{t:n}=x();return s.jsx(b,{label:n("domains:projects.description"),children:s.jsx(xe,{...e("description")})})},sn=()=>{var o;const{register:e,formState:{errors:n}}=V(),{t:a}=x(),t=(o=n.name)!=null&&o.message?a(`general_errors:${n.name.message}`):void 0;return s.jsx(b,{label:a("domains:projects.project_name"),errorMessage:t,isRequired:!0,children:s.jsx(B,{...e("name")})})},nn=()=>{const[e]=x(),{field:n}=S({name:"project_type"}),a=v.useMemo(()=>ls.map(t=>({value:t,label:e(`domains:projects.type.${t}`)})),[e]);return s.jsx(b,{label:e("domains:projects.project_type"),children:s.jsx(I,{options:a,value:a.find(t=>t.value===n.value),onChange:t=>{t&&n.onChange(t.value)}})})},an=()=>{const[e]=x(),{field:n}=S({name:"hard_skill_ids"}),{data:a}=Ze(),t=v.useMemo(()=>a?a.map(r=>({value:r.id,label:r.name})):[],[a]),o=t.filter(r=>n.value.some(l=>l===r.value));return s.jsx(b,{label:e("domains:projects.service_area"),children:s.jsx(I,{isMulti:!0,placeholder:e("domains:filters.placeholders.placeholder_select"),options:t,value:o,onChange:r=>{n.onChange(r.length>0?r.map(l=>l.value):[])},size:"md"})})},tn=()=>{const{register:e}=V(),{t:n}=x();return s.jsx(b,{label:n("domains:projects.solution"),children:s.jsx(xe,{...e("solution")})})},on=()=>{const[e]=x(),{field:n}=S({name:"status"}),a=v.useMemo(()=>is.map(t=>({value:t,label:e(`domains:projects.status.${t}`)})),[e]);return s.jsx(b,{label:e("domains:employee.titles.status"),isRequired:!0,children:s.jsx(I,{options:a,value:a.find(t=>t.value===n.value),onChange:t=>{t&&n.onChange(t.value)}})})},rn=({project:e,isOpenMainInfoTab:n,onCloseMainInfoTab:a,onConfirm:t,isLoading:o})=>{const{t:r}=x(),l=de({defaultValues:ue(e),mode:"onBlur",resolver:ce(Ts)}),{reset:g}=l,h=()=>{l.reset(),a()};return v.useEffect(()=>{g(ue(e),{keepDefaultValues:!1})},[g,e]),s.jsx(X,{autoFocus:!1,title:r("domains:employee.titles.profile_tabs.personal_information.general.section_title").toUpperCase(),isOpen:n,onClose:h,shouldUseOverlay:!0,isCentered:!0,contentProps:{maxWidth:"688px",maxHeight:"80%",overflow:"auto"},footer:s.jsx(Q,{onCancel:h,onReset:()=>l.reset(),onSubmit:l.handleSubmit(p=>{const m=ue(e),_=Object.keys(p).reduce((i,c)=>{const u=p[c],j=m[c];return Es(u,j)||(c==="ended_at"||c==="started_at"?i[c]=p[c].year&&p[c].month?new Date(Number(p[c].year),Number(p[c].month)).toISOString():null:i[c]=u),i},{});t(_)}),isValid:l.formState.isValid,isTouched:l.formState.isDirty,isLoading:o}),children:s.jsx(M,{flexDirection:"column",gap:"20px",children:s.jsxs(me,{...l,children:[s.jsxs(T,{justifyContent:"space-between",children:[s.jsx(Ys,{onReset:()=>l.resetField("avatar")}),s.jsxs(Bs,{width:"366px",spacing:"20px",children:[s.jsx(Xs,{}),s.jsx(sn,{}),s.jsx(on,{})]})]}),s.jsx(nn,{}),s.jsx(Ks,{}),s.jsx(Js,{}),s.jsx(Zs,{}),s.jsx(an,{}),s.jsx(en,{}),s.jsx(Qs,{}),s.jsx(tn,{})]})})})},ln=({project:e,canEdit:n})=>{const[a]=x(),{isOpen:t,onOpen:o,onClose:r}=le(),[l,{isLoading:g}]=Ue(),h=R(k),p=U(k),m=async _=>{try{await l({data:_,id:e.id}).unwrap(),r(),p({description:a("domains:global.confirmations.descriptions.saved")})}catch(i){console.error(i),h({description:a("domains:global.errors.descriptions.unknown_error")})}};return s.jsxs(G,{title:a("domains:employee.titles.profile_tabs.personal_information.general.section_title"),onEdit:n?o:void 0,children:[s.jsxs(T,{flexDirection:"column",gap:"20px",children:[s.jsx(z,{name:a("domains:projects.region"),value:e.country?e.country.name:a("domains:employee.errors.no_data")}),s.jsx(z,{name:a("domains:projects.business_domain"),value:e.business_domain?a(`enums:business_domains.${e.business_domain}`):a("domains:employee.errors.no_data")}),s.jsx(z,{name:a("domains:projects.service_area"),value:e.hard_skills&&e.hard_skills.length>0?e.hard_skills.map(_=>_.name).join(", "):a("domains:employee.errors.no_data")}),s.jsx(z,{name:a("domains:projects.description"),value:e.description||a("domains:employee.errors.no_data")}),s.jsx(z,{name:a("domains:projects.challenge"),value:e.challenge||a("domains:employee.errors.no_data")}),s.jsx(z,{name:a("domains:projects.solution"),value:e.solution||a("domains:employee.errors.no_data")})]}),s.jsx(rn,{project:e,isOpenMainInfoTab:t,onCloseMainInfoTab:r,onConfirm:m,isLoading:g})]})},dn=({project:e,canEdit:n})=>s.jsxs(w,{children:[s.jsx(ln,{project:e,canEdit:n}),s.jsx(Ws,{project:e,canEdit:n})]}),cn=({project:e})=>{const[n]=x();return s.jsx(G,{title:n("domains:employee.titles.profile_tabs.personal_information.general.section_title"),children:`${e.name||"Project"} slides`})},mn=d.object({team:d.array(d.object({employee_id:d.number().nullable().superRefine((e,n)=>(e||n.addIssue({code:d.ZodIssueCode.custom,message:"required_field"}),e)),position_id:d.array(d.number()).superRefine((e,n)=>(e.length===0&&n.addIssue({code:d.ZodIssueCode.custom,message:"required_field"}),e)),start_date:d.object({month:d.string().nullable(),year:d.string().nullable()}).superRefine((e,n)=>(qe(e)||n.addIssue({code:d.ZodIssueCode.custom,message:"incorrect_date",path:["month"]}),e)),end_date:d.object({month:d.string().nullable(),year:d.string().nullable()}).superRefine((e,n)=>(ze(e)||n.addIssue({code:d.ZodIssueCode.custom,message:"incorrect_date",path:["month"]}),e))}).refine(e=>We(e.start_date,e.end_date),{message:"invalid_range",path:["end_date.month"]}))}),Te=()=>({team:[{employee_id:null,position_id:[],start_date:{month:null,year:null},end_date:{year:null,month:null}}]}),un=({index:e})=>{var p,m,_,i,c,u,j,C,P,$,F,q,L,N,y,H;const[n]=x(),{field:a}=S({name:`team.${e}.start_date`}),{field:t}=S({name:`team.${e}.end_date`}),{register:o,formState:{errors:r},getValues:l}=V(),g=l(`team.${e}.start_date.year`),h=l(`team.${e}.end_date.year`);return s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(b,{label:n("domains:employee.titles.profile_tabs.education.start_date"),errorMessage:(i=(_=(m=(p=r.team)==null?void 0:p[e])==null?void 0:m.start_date)==null?void 0:_.month)!=null&&i.message?n(`general_errors:${(j=(u=(c=r.team[e])==null?void 0:c.start_date)==null?void 0:u.month)==null?void 0:j.message}`):void 0,isRequired:!0,children:s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(I,{...a,onChange:f=>{f&&a.onChange({year:g,month:String(f.value)})},options:D,getOptionLabel:f=>n(f.label),value:(C=D.find(f=>String(f.value)===String(a.value.month)))!=null?C:null,placeholder:n("general_placeholders:month")}),s.jsx(O,{hasArrow:!0,place:"top",labelText:n("enums:notes.start_year"),children:s.jsx(B,{...o(`team.${e}.start_date.year`),onBlur:a.onBlur,placeholder:n("general_placeholders:year")})})]})}),s.jsx(b,{label:n("domains:employee.titles.profile_tabs.education.end_date"),errorMessage:(q=(F=($=(P=r.team)==null?void 0:P[e])==null?void 0:$.end_date)==null?void 0:F.month)!=null&&q.message?n(`general_errors:${(y=(N=(L=r.team[e])==null?void 0:L.end_date)==null?void 0:N.month)==null?void 0:y.message}`):void 0,children:s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(I,{...t,onChange:f=>{f&&t.onChange({year:h,month:String(f.value)})},options:D,getOptionLabel:f=>n(f.label),value:(H=D.find(f=>String(f.value)===String(t.value.month)))!=null?H:null,placeholder:n("general_placeholders:month")}),s.jsx(O,{hasArrow:!0,place:"top",labelText:n("enums:notes.end_year"),children:s.jsx(B,{...o(`team.${e}.end_date.year`),onBlur:t.onBlur,placeholder:n("general_placeholders:year")})})]})})]})},pn=({index:e})=>{var h,p,m,_,i;const{field:n,formState:{errors:a}}=S({name:`team.${e}.employee_id`}),{t}=x(),[o,r]=v.useState(null),[l]=Xe(),g=v.useCallback(async c=>(await l({page:1,elementsPerPage:100,filters:{name:c}}).unwrap()).items.map(j=>({value:j.id,label:`${j.first_name} ${j.last_name}`})),[l]);return s.jsx(b,{label:t("domains:projects.employee_name"),isRequired:!0,errorMessage:(m=(p=(h=a.team)==null?void 0:h[e])==null?void 0:p.employee_id)!=null&&m.message?t(`general_errors:${(i=(_=a.team[e])==null?void 0:_.employee_id)==null?void 0:i.message}`):void 0,children:s.jsx(Ae,{...n,placeholder:t("domains:filters.placeholders.placeholder_select"),loadOptions:g,onChange:c=>{c&&n.onChange(c.value),r(c)},value:o,defaultOptions:!0,cacheOptions:!0,isMulti:!1})})},hn=({index:e})=>{var g,h,p,m,_;const{field:n,formState:{errors:a}}=S({name:`team.${e}.position_id`}),{data:t}=Qe(),o=v.useMemo(()=>t?t.map(i=>({value:i.id,label:i.name})):[],[t]),[r]=x(),l=o.filter(i=>n.value.some(c=>c===i.value));return s.jsx(b,{label:r("domains:employee.titles.profile_tabs.work_experience.position"),isRequired:!0,errorMessage:(p=(h=(g=a.team)==null?void 0:g[e])==null?void 0:h.position_id)!=null&&p.message?r(`general_errors:${(_=(m=a.team[e])==null?void 0:m.position_id)==null?void 0:_.message}`):void 0,children:s.jsx(I,{...n,placeholder:r("domains:filters.placeholders.placeholder_select"),options:o,value:l,onChange:i=>{n.onChange(i.map(c=>c.value))},isMulti:!0,size:"md"})})},gn=({index:e,remove:n,fields:a})=>s.jsxs(T,{justifyContent:"space-between",children:[s.jsxs(T,{flexDirection:"column",gap:"20px",children:[s.jsx(pn,{index:e}),s.jsx(hn,{index:e}),s.jsx(un,{index:e})]}),s.jsx(Z,{isDisabled:a.length===1,"aria-label":"delete_employee",variant:"iconButtonSmallPrimary",icon:s.jsx(De,{color:"inherit"}),onClick:()=>n(e),position:"absolute",right:"20px"})]}),_n=({project:e,isOpenTeamTab:n,onCloseTeamTab:a,onConfirm:t,isLoading:o})=>{const{t:r}=x(),l=de({defaultValues:Te(),mode:"onBlur",resolver:ce(mn)}),{fields:g,append:h,remove:p}=Ye({control:l.control,name:"team"}),{reset:m}=l,_=()=>{l.reset(),a()};return v.useEffect(()=>{m(Te(),{keepDefaultValues:!1})},[m,e]),s.jsx(X,{autoFocus:!1,title:r("domains:projects.team"),isOpen:n,onClose:_,shouldUseOverlay:!0,isCentered:!0,contentProps:{maxWidth:"688px"},footer:s.jsx(Q,{onCancel:_,onReset:()=>l.reset(),onSubmit:l.handleSubmit(i=>{const c=i.team.map(u=>({end_date:u.end_date.month!==null&&u.end_date.year?te(Number(u.end_date.year),Number(u.end_date.month)):null,start_date:te(Number(u.start_date.year),Number(u.start_date.month)),position_id:u.position_id,employee_id:u.employee_id}));t({team:c})}),isValid:l.formState.isValid,isTouched:l.formState.isDirty,isLoading:o}),children:s.jsx(M,{flexDirection:"column",gap:"20px",children:s.jsx(me,{...l,children:s.jsxs(T,{flexDirection:"column",gap:"20px",children:[g.map((i,c)=>s.jsx(gn,{fields:g,remove:p,index:c},i.id)),s.jsx(T,{justifyContent:"flex-start",children:s.jsx(ee,{variant:"primaryGhost",leftIcon:s.jsx(Oe,{}),onClick:()=>h({employee_id:null,end_date:{month:null,year:null},start_date:{month:null,year:null},position_id:[]}),children:r("domains:projects.employee")})})]})})})})},xn=({isOpen:e,onCloseTab:n,projectIdNumber:a})=>{const[t]=x(),[o,r]=v.useState(null),[l,{isLoading:g}]=Ss(),h=R(k),p=U(k),m=()=>{r(null),n()},_=async u=>{try{await l({projectId:a,id:u}).unwrap(),p({description:t("domains:global.confirmations.descriptions.saved")}),m()}catch(j){console.error(j),h({description:t("domains:global.errors.descriptions.unknown_error")})}},[i]=Xe(),c=v.useCallback(async u=>(await i({page:1,elementsPerPage:100,filters:{name:u}}).unwrap()).items.map(C=>({value:C.id,label:`${C.first_name} ${C.last_name}`})),[i]);return s.jsx(X,{autoFocus:!1,title:t("domains:projects.titles.project_tabs.team_management.add_manager").toUpperCase(),isOpen:e,onClose:m,shouldUseOverlay:!0,isCentered:!0,contentProps:{maxWidth:"688px",justifyContent:"flex-end"},footer:s.jsx(Q,{onCancel:m,onSubmit:()=>o?_(o.value):null,isValid:Boolean(o&&o.value),isTouched:Boolean(o&&o.value),submitTag:"add",isLoading:g,variantButton:"secondaryGhost"}),children:s.jsx(b,{label:t("domains:projects.titles.project_tabs.team_management.name_manager"),children:s.jsx(Ae,{placeholder:t("general_placeholders:select"),loadOptions:c,onChange:u=>{u&&r(u)},value:o,defaultOptions:!0,cacheOptions:!0,isMulti:!1,size:"md"})})})},Se={border:"1px solid var(--chakra-colors-brand-stroke)",borderRadius:"4px",padding:"12px"},Ke={width:"102px",alignItems:"center"},he={display:"flex",alignItems:"center",justifyContent:"center",boxSize:"24px",color:"brand.darkGray",_hover:{color:"brand.lightGray"},_active:{color:"brand.ghostGray"}},fn=({getValue:e,table:{options:{meta:n={}}}})=>{const[a]=x(),{onDeleteManager:t}=n;if(!t)throw new Error("Table should implement onDeleteManager and project profile!");const o=e();return s.jsx(O,{minWidth:"min-content",hasArrow:!0,place:"top",labelText:a("general_actions:delete"),children:s.jsx(Z,{icon:s.jsx(Pe,{}),"aria-label":a("general_actions:delete"),onClick:()=>{t(o.id)},sx:he,variant:"iconButtonSmall"})})},jn=({getValue:e})=>{const[n]=x(),a=e();return s.jsx(Fe,{to:`${se.Employees}/${a.id}`,children:s.jsxs(w,{display:"flex",gap:2,alignItems:"center",children:[s.jsx(O,{hasArrow:!0,place:"left",labelText:a.status?n(`enums:employee_status.${a.status}`):void 0,children:s.jsx(ge,{variant:a.status?a.status:void 0,size:"sm",src:a.avatar?`https://team-prod.cybergizer.com${a.avatar}`:void 0})}),s.jsx(A,{variant:"mm",color:"brand.headline",children:`${a.first_name} ${a.last_name}`})]})})},Me=({column:{id:e}})=>{const[n]=x();return s.jsx("span",{children:n(`domains:employee.table_headers.${e}`,{count:100})})},W={FullName:"name",Positions:"position_other",Date:"date",Actions:"actions"},ke=Be(),bn=[ke.accessor(e=>e,{id:W.FullName,cell:jn,header:Me}),ke.accessor(e=>e,{id:W.Actions,cell:fn,header:Me})],yn=({rows:e})=>{const[n]=x();return s.jsx(Re,{children:e.length>0?e.map(a=>s.jsx(Y,{children:a.getVisibleCells().map(t=>s.jsx(oe,{_last:{display:"flex",justifyContent:"flex-end",alignItems:"center",minHeight:"65px"},children:ie(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):s.jsx(Y,{children:s.jsx(oe,{colSpan:2e3,textAlign:"center",children:n("domains:employee.errors.no_information")})})})},vn=({headerGroups:e})=>s.jsx(Ve,{children:e.map(n=>s.jsx(Y,{children:n.headers.map(a=>s.jsx(Le,{whiteSpace:"nowrap",_last:Ke,children:s.jsx(w,{display:"flex",alignItems:"center",children:ie(a.column.columnDef.header,a.getContext())})},a.id))},n.id))}),Cn=({project:e})=>{const[n]=x(),[a,t]=v.useState(null),o=R(k),r=U(k),[l,{isLoading:g}]=Ms(),h=Ne({columns:bn,data:e.managers,getCoreRowModel:He(),meta:{onDeleteManager:m=>{t(m)}}}),p=async()=>{if(a!==null){t(null);try{await l({projectId:e.id,id:a}).unwrap(),r({description:n("domains:global.confirmations.descriptions.deleted")}),t(null)}catch(m){console.error(m),o({description:n("domains:global.errors.descriptions.unknown_error")})}}};return s.jsxs(s.Fragment,{children:[s.jsxs(Ge,{children:[s.jsx(vn,{headerGroups:h.getHeaderGroups()}),s.jsx(yn,{rows:h.getRowModel().rows})]}),s.jsx(_e,{title:n("domains:global.confirmations.titles.delete_manager"),description:n("domains:global.confirmations.descriptions.delete_manager"),onConfirm:p,isOpen:a!==null,onClose:()=>t(null),isLoading:g})]})},wn=d.object({work_experience_positions:d.array(d.object({position_id:d.number().nullable().superRefine((e,n)=>(e||n.addIssue({code:d.ZodIssueCode.custom,message:"required_field"}),e)),start_date:d.object({month:d.string().nullable(),year:d.string().nullable()}).superRefine((e,n)=>(qe(e)||n.addIssue({code:d.ZodIssueCode.custom,message:"required_field",path:["month"]}),e)),end_date:d.object({month:d.string().nullable(),year:d.string().nullable()}).superRefine((e,n)=>(ze(e)||n.addIssue({code:d.ZodIssueCode.custom,message:"required_field",path:["month"]}),e)),id:d.number().optional(),work_experience_id:d.number().nullable().optional()}).refine(e=>We(e.start_date,e.end_date),{message:"invalid_range",path:["end_date.month"]}))}),pe=e=>({work_experience_positions:e.map(n=>({position_id:(n==null?void 0:n.position_id)||null,start_date:{month:n!=null&&n.start_date?String(ne(new Date(n.start_date))):null,year:n!=null&&n.start_date?String(ae(new Date(n.start_date))):null},end_date:{month:n!=null&&n.end_date?String(ne(new Date(n.end_date))):null,year:n!=null&&n.end_date?String(ae(new Date(n.end_date))):null},work_experience_id:n==null?void 0:n.work_experience_id,id:n==null?void 0:n.id}))}),Tn=({index:e})=>{var p,m,_,i,c,u,j,C,P,$,F,q,L,N,y,H;const[n]=x(),{field:a}=S({name:`work_experience_positions.${e}.start_date`}),{field:t}=S({name:`work_experience_positions.${e}.end_date`}),{register:o,formState:{errors:r},getValues:l}=V(),g=l(`work_experience_positions.${e}.start_date.year`),h=l(`work_experience_positions.${e}.end_date.year`);return s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(b,{label:n("domains:employee.titles.profile_tabs.education.start_date"),errorMessage:(i=(_=(m=(p=r.work_experience_positions)==null?void 0:p[e])==null?void 0:m.start_date)==null?void 0:_.month)!=null&&i.message?n(`general_errors:${(j=(u=(c=r.work_experience_positions[e])==null?void 0:c.start_date)==null?void 0:u.month)==null?void 0:j.message}`):void 0,isRequired:!0,children:s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(I,{...a,isClearable:!0,onChange:f=>{a.onChange({year:g,month:f===null?null:String(f.value)})},options:D,getOptionLabel:f=>n(f.label),value:(C=D.find(f=>String(f.value)===String(a.value.month)))!=null?C:null,placeholder:n("general_placeholders:month")}),s.jsx(O,{hasArrow:!0,place:"top",labelText:n("enums:notes.start_year"),children:s.jsx(B,{...o(`work_experience_positions.${e}.start_date.year`),onBlur:f=>{f.target.value.trim()===""&&a.onChange({year:null,month:a.value.month}),a.onBlur()},placeholder:n("general_placeholders:year")})})]})}),s.jsx(b,{label:n("domains:employee.titles.profile_tabs.education.end_date"),errorMessage:(q=(F=($=(P=r.work_experience_positions)==null?void 0:P[e])==null?void 0:$.end_date)==null?void 0:F.month)!=null&&q.message?n(`general_errors:${(y=(N=(L=r.work_experience_positions[e])==null?void 0:L.end_date)==null?void 0:N.month)==null?void 0:y.message}`):void 0,children:s.jsxs(M,{gridTemplateColumns:"1fr 1fr",gap:E,children:[s.jsx(I,{...t,isClearable:!0,onChange:f=>{t.onChange({year:h,month:f===null?null:String(f.value)})},options:D,getOptionLabel:f=>n(f.label),value:(H=D.find(f=>String(f.value)===String(t.value.month)))!=null?H:null,placeholder:n("general_placeholders:month")}),s.jsx(O,{hasArrow:!0,place:"top",labelText:n("enums:notes.end_year"),children:s.jsx(B,{...o(`work_experience_positions.${e}.end_date.year`),onBlur:f=>{f.target.value.trim()===""&&t.onChange({year:null,month:t.value.month}),t.onBlur()},placeholder:n("general_placeholders:year")})})]})})]})},Sn=({index:e})=>{var g,h,p,m,_;const{field:n,formState:{errors:a}}=S({name:`work_experience_positions.${e}.position_id`}),{data:t}=Qe(),o=v.useMemo(()=>t?t.map(i=>({value:i.id,label:i.name})):[],[t]),[r]=x(),l=o.filter(i=>n.value===i.value);return s.jsx(b,{label:r("domains:employee.titles.profile_tabs.work_experience.position"),isRequired:!0,errorMessage:(p=(h=(g=a.work_experience_positions)==null?void 0:g[e])==null?void 0:h.position_id)!=null&&p.message?r(`general_errors:${(_=(m=a.work_experience_positions[e])==null?void 0:m.position_id)==null?void 0:_.message}`):void 0,children:s.jsx(I,{...n,placeholder:r("domains:filters.placeholders.placeholder_select"),options:o,value:l,onChange:i=>{i&&n.onChange(i.value)},size:"md"})})},Mn=({index:e,fields:n,remove:a})=>s.jsxs(T,{justifyContent:"space-between",children:[s.jsxs(T,{flexDirection:"column",gap:"20px",children:[s.jsx(Sn,{index:e}),s.jsx(Tn,{index:e})]}),s.jsx(Z,{isDisabled:n.length===1,"aria-label":"delete_employee",variant:"iconButtonSmall",icon:s.jsx(De,{color:"var(--chakra-colors-brand-accentRed)"}),onClick:()=>a(e)})]}),kn=({employee:e,projectId:n,isOpenPositionTab:a,onClosePositionTab:t,editMemberTeam:o,setEditMemberTeam:r})=>{const{t:l}=x(),[g,{isLoading:h}]=ks(),p=R(k),m=U(k),_=v.useCallback(()=>e?e.work_experience.map($=>$.work_experience_positions).flat():[null],[e]),i=de({defaultValues:pe(_()),mode:"onBlur",resolver:ce(wn)}),{fields:c,append:u,remove:j}=Ye({control:i.control,name:"work_experience_positions"}),{reset:C}=i,P=()=>{C(),t()};return v.useEffect(()=>{C(pe(_()),{keepDefaultValues:!1})},[C,_]),s.jsx(X,{autoFocus:!1,title:e?Je(`${e.first_name} ${e.last_name}`):"",isOpen:a,onClose:P,shouldUseOverlay:!0,isCentered:!0,contentProps:{maxWidth:"688px"},footer:s.jsx(Q,{onCancel:P,onReset:()=>i.reset(),onSubmit:i.handleSubmit(async $=>{const F=$.work_experience_positions,L=pe(_()).work_experience_positions.filter(y=>!F.some(H=>H.id===y.id)).map(y=>({id:y.id,_destroy:null})),N=F.map(y=>({end_date:y.end_date.month!==null&&y.end_date.year?te(Number(y.end_date.year),Number(y.end_date.month)):null,start_date:te(Number(y.start_date.year),Number(y.start_date.month)),position_id:y.position_id,work_experience_id:y.work_experience_id,id:y.id}));if(o!==null){r(null);try{await g({data:{work_experience_positions:[...N,...L]},projectId:n}).unwrap(),m({description:l("domains:global.confirmations.descriptions.deleted")}),r(null)}catch(y){console.error(y),p({description:l("domains:global.errors.descriptions.unknown_error")})}}}),isValid:i.formState.isValid,isTouched:i.formState.isDirty,isLoading:h}),children:s.jsx(M,{flexDirection:"column",gap:"20px",children:s.jsx(me,{...i,children:s.jsxs(T,{flexDirection:"column",gap:"20px",children:[c.map(($,F)=>s.jsx(Mn,{fields:c,remove:j,index:F},$.id)),s.jsx(T,{justifyContent:"flex-start",children:s.jsx(ee,{variant:"primaryGhost",leftIcon:s.jsx(Oe,{}),onClick:()=>{var $;return u({end_date:{month:null,year:null},start_date:{month:null,year:null},position_id:null,work_experience_id:($=_()[0])==null?void 0:$.work_experience_id})},children:l("domains:employee.titles.profile_tabs.work_experience.position")})})]})})})})},$n=({getValue:e,table:{options:{meta:n={}}}})=>{const[a]=x(),{onEditMemberTeam:t,onDeleteMemberTeam:o}=n;if(!t||!o)throw new Error("Table should implement onEditMemberTeam or onDeleteMemberTeam and project profile!");const r=e();return s.jsxs(w,{display:"flex",alignItems:"center",gap:"8px",children:[s.jsx(O,{minWidth:"min-content",hasArrow:!0,place:"top",labelText:a("general_actions:edit"),children:s.jsx(Z,{icon:s.jsx(ds,{}),"aria-label":a("general_actions:edit"),onClick:()=>{t(r.id)},sx:{...he,boxSize:"20px",minWidth:"20px"},variant:"iconButtonSmall"})}),s.jsx(O,{minWidth:"min-content",hasArrow:!0,place:"top",labelText:a("general_actions:delete"),children:s.jsx(Z,{icon:s.jsx(Pe,{}),"aria-label":a("general_actions:delete"),onClick:()=>{o(r.work_experience.map(l=>l.work_experience_positions[0].work_experience_id))},sx:he,variant:"iconButtonSmall"})})]})},In=({getValue:e})=>{const[n,{language:a}]=x(),{work_experience:t}=e();return s.jsx(w,{display:"flex",flexDirection:"column",gap:"14px",children:t.length!==0?t.map(({work_experience_positions:o})=>o.length!==0?o.map(r=>s.jsxs(w,{display:"flex",gap:"5px",children:[s.jsx(w,{children:re(r.start_date,a)}),s.jsx(w,{children:r.end_date?` — ${re(r.end_date,a)}`:` — ${n("enums:notes.nowadays")}`})]},r.id)):s.jsx(w,{children:n("domains:employee.errors.no_data")})):null})},Dn=({getValue:e})=>{const n=e();return s.jsx(Fe,{to:`${se.Employees}/${n.id}`,children:s.jsxs(w,{display:"flex",gap:2,alignItems:"center",children:[s.jsx(O,{hasArrow:!0,place:"left",children:s.jsx(ge,{size:"sm",src:n.avatar?`https://team-prod.cybergizer.com${n.avatar}`:void 0})}),s.jsx(A,{variant:"mm",color:"brand.headline",children:`${n.first_name} ${n.last_name}`})]})})},On=({getValue:e})=>{const[n]=x(),{work_experience:a}=e();return s.jsx(w,{display:"flex",flexDirection:"column",gap:"14px",children:a.map(t=>t.positions.length!==0?t.positions.map(o=>s.jsx(w,{color:"brand.ghostGray",children:o.name},o.id)):s.jsx(w,{children:n("domains:employee.errors.no_data")}))})},J=({column:{id:e}})=>{const[n]=x();return s.jsx("span",{children:n(`domains:employee.table_headers.${e}`,{count:100})})},K=Be(),Pn=[K.accessor(e=>e,{id:W.FullName,cell:Dn,header:J}),K.accessor(e=>e,{id:W.Positions,cell:On,header:J,enableSorting:!1}),K.accessor(e=>e,{id:W.Date,cell:In,header:J,enableSorting:!1}),K.accessor(e=>e,{id:W.Actions,cell:$n,header:J})],Fn=({rows:e})=>{const[n]=x();return s.jsx(Re,{children:e.length>0?e.map(a=>s.jsx(Y,{children:a.getVisibleCells().map(t=>s.jsx(oe,{children:ie(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):s.jsx(Y,{children:s.jsx(oe,{colSpan:2e3,textAlign:"center",children:n("domains:employee.errors.no_information")})})})},En=({headerGroups:e})=>s.jsx(Ve,{children:e.map(n=>s.jsx(Y,{children:n.headers.map(a=>s.jsx(Le,{whiteSpace:"nowrap",_last:Ke,children:s.jsx(w,{display:"flex",alignItems:"center",children:ie(a.column.columnDef.header,a.getContext())})},a.id))},n.id))}),An=({project:e})=>{const[n]=x(),[a,t]=v.useState(null),[o,r]=v.useState(null),l=R(k),g=U(k),[h,{isLoading:p}]=$s(),m=Ne({columns:Pn,data:e.team,getCoreRowModel:He(),meta:{onEditMemberTeam:c=>{t(c)},onDeleteMemberTeam:c=>{r(c)}}}),_=()=>e.team.find(c=>c.id===a),i=async()=>{if(o!==null){r(null);try{await h({projectId:e.id,id:o}).unwrap(),g({description:n("domains:global.confirmations.descriptions.deleted")}),r(null)}catch(c){console.error(c),l({description:n("domains:global.errors.descriptions.unknown_error")})}}};return s.jsxs(s.Fragment,{children:[s.jsxs(Ge,{children:[s.jsx(En,{headerGroups:m.getHeaderGroups()}),s.jsx(Fn,{rows:m.getRowModel().rows})]}),s.jsx(kn,{employee:_(),projectId:e.id,editMemberTeam:a,setEditMemberTeam:t,isOpenPositionTab:a!==null,onClosePositionTab:()=>t(null)}),s.jsx(_e,{title:n("domains:global.confirmations.titles.delete_member"),description:n("domains:global.confirmations.descriptions.delete_member"),onConfirm:i,isOpen:o!==null,onClose:()=>r(null),isLoading:p})]})},Bn=({project:e,canEdit:n})=>{const[a]=x(),[t,o]=v.useState(!1),[r,{isLoading:l}]=Is(),{isOpen:g,onOpen:h,onClose:p}=le(),m=R(k),_=U(k),i=async c=>{try{await r({data:c,projectId:e.id}).unwrap(),p(),_({description:a("domains:global.confirmations.descriptions.saved")})}catch(u){console.error(u),m({description:a("domains:global.errors.descriptions.unknown_error")})}};return s.jsxs(s.Fragment,{children:[s.jsx(G,{title:a("domains:projects.titles.project_tabs.team_management.managers"),onAdd:n?()=>o(!0):void 0,children:s.jsxs(w,{...Se,children:[s.jsx(Cn,{project:e}),s.jsx(xn,{isOpen:t,onCloseTab:()=>o(!1),projectIdNumber:e.id})]})}),s.jsx(G,{title:a("domains:projects.titles.project_tabs.team_management.team"),sx:{borderBottom:"none"},onAdd:n?h:void 0,children:s.jsxs(w,{...Se,children:[s.jsx(An,{project:e}),s.jsx(_n,{project:e,isOpenTeamTab:g,onCloseTeamTab:p,onConfirm:i,isLoading:l})]})})]})},$e=[{title:"main_information",panel:dn},{title:"attachments",panel:Ls},{title:"team_management",panel:Bn},{title:"slides",panel:cn}],Rn=({project:e,canEdit:n})=>{const{t:a}=x();return s.jsxs(gs,{children:[s.jsx(_s,{children:$e.map(t=>s.jsx(xs,{children:a(`enums:projects_tabs.${t.title}`)},t.title))}),s.jsx(fs,{children:$e.map(({title:t,panel:o})=>s.jsx(js,{children:s.jsx(o,{project:e,canEdit:n})},t))})]})},sa=()=>{const{id:e}=Ie(),{data:n,isLoading:a,isError:t}=Ds(e&&bs(+e)?+e:cs.skipToken),o=ms(us);if(a)return s.jsx(ps,{});if(t||!n)return s.jsx(Ce,{children:s.jsx("div",{children:"Oops, something went wrong :("})});const r=ys(o);return s.jsx(Ce,{children:s.jsxs(T,{gap:ye,height:"100%",overflow:"hidden",children:[s.jsx(T,{width:As,maxH:"100%",gap:ye,flexDirection:"column",overflow:"hidden",children:s.jsx(w,{padding:"40px",...ve,children:s.jsx(Vs,{project:n,canEdit:r})})}),s.jsx(w,{flex:"1",overflow:"hidden",...ve,children:s.jsx(Rn,{project:n,canEdit:r})})]})})};export{sa as Project};
