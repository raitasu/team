import{R as X,J as ee,K as te,x as d,ap as se,t,O,Q as ae,V as c,aq as re,ar as oe,r as u,as as ne,at as le,Y as z,Z as N,X as B,$ as H,ae as ce,af as ie,a9 as de,aa as ue,ah as me,au as pe,a8 as T,a7 as ge,B as S,av as he,aw as je,ax as xe,ay as fe,az as Ce,aA as V,aB as be,T as _,L as ve,aC as ye,P as Pe,aD as D,aE as Se,aF as _e,aG as v,an as we,am as De,ag as Me}from"./index-b52e60c4.js";import{F as C,S as w,I as k,T as G,d as Te,e as Ae,f as F,h as $,j as Z,k as He,l as ke,c as Ee,u as Fe,a as Be,g as Re,b as Ie}from"./index-e9f440b3.js";import{u as b,a as U,b as Oe,B as Ve,F as $e,s as Le}from"./index-6daba2ff.js";import{i as ze,A as Ne,b as L,d as Ge,G as A,a as Ze}from"./dates.utils-6e33ef55.js";import{P as Ue,u as qe,a as We,b as Ye}from"./ProjectAvatarEditor-478221fd.js";import{u as Qe}from"./workExperience.api-a9afe45d.js";import{C as E,o as M}from"./utils-23d7ea7a.js";import{D as Je,M as Ke}from"./chunk-YLPWWAYV-171e0be4.js";import{u as Xe,P as et}from"./PageToolbox-e4e89f14.js";import{C as q}from"./ControlButton-705a2275.js";import{P as tt}from"./index-44705779.js";import{g as st}from"./index-e0576515.js";import{P as at}from"./PageContainer-cf710d20.js";function rt(e){const s=Object.assign({},e);for(let a in s)s[a]===void 0&&delete s[a];return s}var W=X(function(s,a){const r=ee("Avatar",s),{children:o,borderColor:n,max:i,spacing:h="-0.75rem",borderRadius:j="full",...m}=te(s),p=st(o),x=i!=null?p.slice(0,i):p,f=i!=null&&p.length-i,g=x.reverse().map((R,J)=>{var I;const K={marginEnd:J===0?0:h,size:s.size,borderColor:(I=R.props.borderColor)!=null?I:n,showBorder:!0};return d.cloneElement(R,rt(K))}),Y={display:"flex",alignItems:"center",justifyContent:"flex-end",flexDirection:"row-reverse",...r.group},Q={borderRadius:j,marginStart:h,...se,...r.excessLabel};return t.jsxs(O.div,{ref:a,role:"group",__css:Y,...m,className:ae("chakra-avatar__group",s.className),children:[f>0&&t.jsx(O.span,{className:"chakra-avatar__excess",__css:Q,children:`+${f}`}),g]})});W.displayName="AvatarGroup";const ot=c.object({month:c.string().nullable(),year:c.string().nullable()}),nt=c.object({month:c.string().nullable(),year:c.string().nullable()}),lt=c.object({avatar:c.instanceof(File).nullable().superRefine((e,s)=>(e&&!ze(e)&&s.addIssue({code:c.ZodIssueCode.custom,message:`File must be one of ${Ne.join(", ")} but was ${e instanceof File?e.type:e}`}),null)),name:c.string().min(1,"required_field"),company_name:c.object({label:c.string().nullable(),value:c.string().nullable()}),status:re.nullable(),type:oe,managers:c.object({label:c.string().nullable(),value:c.string().nullable()}).array(),startDate:ot.superRefine((e,s)=>(L(e)||s.addIssue({code:c.ZodIssueCode.custom,message:"incorrect_date",path:["month"]}),e)),endDate:nt.superRefine((e,s)=>(L(e)||s.addIssue({code:c.ZodIssueCode.custom,message:"incorrect_date",path:["month"]}),e))}).refine(e=>Ge(e.startDate,e.endDate,!0),{message:"invalid_range",path:["endDate.month"]}),ct=({onReset:e})=>{var o;const{field:s,formState:{errors:a}}=b({name:"avatar"}),{field:r}=b({name:"status"});return t.jsx(C,{errorMessage:(o=a.avatar)!=null&&o.message?a.avatar.message:void 0,children:t.jsx(Ue,{avatar:s.value,status:r.value,onAvatarChanged:n=>{s.onChange(n),s.onBlur()},onReset:e})})},it=()=>{const[e]=u(),{field:s}=b({name:"company_name"}),{data:a}=Qe(),r=d.useMemo(()=>a?a.map(n=>({label:n.name,value:String(n.id)})):[],[a]),o=d.useMemo(()=>s.value.label?r.find(n=>n.label===s.value.label):null,[s.value,r]);return t.jsx(C,{label:e("domains:projects.titles.company_name"),children:t.jsx(w,{placeholder:e("domains:filters.placeholders.placeholder_select"),isClearable:!0,options:r,value:o,onChange:n=>{n&&s.onChange(n)},size:"md"})})},dt=()=>{var j,m,p,x,f;const[e]=u(),{field:s}=b({name:"startDate"}),{field:a}=b({name:"endDate"}),{register:r,formState:{errors:o},getValues:n}=U(),i=n("startDate.year"),h=n("endDate.year");return t.jsxs(A,{gridTemplateColumns:"1fr 1fr",gap:E,children:[t.jsx(C,{label:e("domains:employee.titles.profile_tabs.education.start_date"),errorMessage:(m=(j=o.startDate)==null?void 0:j.month)!=null&&m.message?e(`general_errors:${o.startDate.month.message}`):void 0,children:t.jsxs(A,{gridTemplateColumns:"1fr 1fr",gap:E,children:[t.jsx(w,{...s,onChange:l=>{s.onChange({year:i,month:l===null?null:String(l.value)})},isClearable:!0,options:M,getOptionLabel:l=>e(l.label),value:(p=M.find(l=>String(l.value)===String(s.value.month)))!=null?p:null}),t.jsx(k,{...r("startDate.year"),onBlur:l=>{l.target.value.trim()===""&&s.onChange({year:null,month:s.value.month}),s.onBlur()}})]})}),t.jsx(C,{label:e("domains:employee.titles.profile_tabs.education.end_date"),errorMessage:(f=(x=o.endDate)==null?void 0:x.month)!=null&&f.message?e(`general_errors:${o.endDate.month.message}`):void 0,children:t.jsxs(A,{gridTemplateColumns:"1fr 1fr",gap:E,children:[t.jsx(w,{...a,isClearable:!0,onChange:l=>{a.onChange({year:h,month:l===null?null:String(l.value)})},options:M,getOptionLabel:l=>e(l.label),value:a.value.month?M.find(l=>String(l.value)===String(a.value.month)):null}),t.jsx(k,{...r("endDate.year"),onBlur:l=>{l.target.value.trim()===""&&a.onChange({year:null,month:a.value.month}),a.onBlur()}})]})})]})},ut=()=>{var r;const{register:e,formState:{errors:s}}=U(),[a]=u();return t.jsx(C,{isRequired:!0,errorMessage:(r=s.name)!=null&&r.message?a(`general_errors:${s.name.message}`):void 0,label:a("domains:projects.titles.project_name"),children:t.jsx(k,{placeholder:a("general_placeholders:enter_text"),...e("name")})})},mt=()=>{const[e]=u(),{field:s}=b({name:"status"}),a=d.useMemo(()=>ne.map(o=>({value:o,label:e(`domains:projects.status.${o}`)})),[e]),r=d.useMemo(()=>s.value!==null?a.find(o=>o.value===s.value):null,[s.value,a]);return t.jsx(C,{label:e("domains:projects.titles.status"),children:t.jsx(w,{placeholder:e("domains:filters.placeholders.placeholder_select"),options:a,value:r,onChange:o=>{o&&s.onChange(o.value)},size:"md"})})},pt=()=>{const[e]=u(),{field:s}=b({name:"type"}),a=d.useMemo(()=>le.map(o=>({value:o,label:e(`domains:projects.type.${o}`)})),[e]),r=d.useMemo(()=>a.find(o=>o.value===s.value),[s.value,a]);return t.jsx(C,{label:e("domains:projects.titles.type"),isRequired:!0,children:t.jsx(w,{placeholder:e("domains:filters.placeholders.placeholder_select"),options:a,value:r,onChange:o=>{o&&s.onChange(o.value)},size:"md"})})},gt=({isOpen:e,onClose:s})=>{const[a]=u(),[r,{isLoading:o}]=qe(),n=Oe({defaultValues:{avatar:null,name:"",company_name:{value:null,label:null},status:null,type:"external",managers:[{value:null,label:null}],startDate:{month:null,year:null},endDate:{month:null,year:null}},mode:"onBlur",resolver:Le(lt)}),i=z(H),h=N(H),j=p=>Object.values(p).includes(null)||Object.values(p).includes(""),m=async p=>{var l;const x=Object.fromEntries(Object.entries(p).filter(g=>g[0]==="startDate"||g[0]==="endDate"||g[0]==="company_name"?!j(g[1]):g[1]!==null)),f=(l=x.managers)==null?void 0:l.filter(g=>g.label);(f==null?void 0:f.length)===0&&delete x.managers;try{await r({project:x}).unwrap(),s(),h({description:a("domains:global.confirmations.descriptions.saved")})}catch(g){console.error(g),i({description:a("domains:global.errors.descriptions.unknown_error")})}};return t.jsx(Ve,{isOpen:e,onClose:s,isCentered:!0,shouldUseOverlay:!0,title:a("domains:employee.actions.create_project").toUpperCase(),contentProps:{maxWidth:"962px",maxHeight:"80%",overflow:"auto"},footer:t.jsx(Ze,{onCancel:s,onReset:()=>n.reset(),isValid:n.formState.isValid,isTouched:n.formState.isDirty,isLoading:o,onSubmit:n.handleSubmit(m),submitTag:"create"}),children:t.jsx($e,{...n,children:t.jsxs(A,{templateColumns:"250px 1fr",gap:"20px",children:[t.jsx(ct,{onReset:()=>n.resetField("avatar")}),t.jsxs(B,{flexDirection:"column",gap:"20px",children:[t.jsx(ut,{}),t.jsx(it,{}),t.jsx(dt,{}),t.jsx(mt,{}),t.jsx(pt,{})]})]})})})},ht=()=>{const[e]=u();return t.jsxs(Je,{children:[t.jsx(Ke,{}),t.jsx(ce,{children:e("domains:filters.titles.filter",{count:100})}),t.jsx(ie,{children:t.jsx(k,{type:"search",placeholder:"Search by project..."})}),t.jsx(de,{children:t.jsx(ue,{isDisabled:!0,children:e("domains:filters.actions.clear_filters")})})]})},jt=()=>{const[e]=u(),{disclosure:{onOpen:s},triggerRef:a}=Xe();return t.jsx(G,{hasArrow:!0,place:"right",labelText:e("domains:filters.titles.filter",{count:100}),children:t.jsx(q,{ref:a,"aria-label":e("domains:filters.titles.filter",{count:100}),variant:"iconButton",onClick:s,icon:t.jsx(me,{})})})},xt=()=>t.jsx(pe,{width:"100%",height:"100%",display:"flex",backgroundColor:"rgba(0, 0, 0, 0.05)",alignItems:"center",justifyContent:"center",position:"absolute",zIndex:"var(--chakra-zIndices-docked)",top:0,left:0,isIndeterminate:!0}),ft=e=>e.projects.pagination,Ct=e=>e.projects.sorting,bt=e=>e.projects.filters,vt=({hasAdminAccess:e,table:s})=>{const a=T(ft),r=T(bt),o=T(Ct),n=ge(),{data:i,isFetching:h}=We({page:a.currentPage,elementsPerPage:a.elementsPerPage,filters:r,sorting:o}),j=Te((i==null?void 0:i.page.total_count)||0,a.elementsPerPage);return t.jsxs(B,{flexDirection:"column",gap:"20px",height:"min-content",maxH:"100%",minHeight:"100%",width:"100%",children:[t.jsxs(S,{flex:"1",minH:"0",overflow:"auto",border:"1px solid var(--chakra-colors-brand-stroke)",borderRadius:"4px",backgroundColor:"var(--chakra-colors-brand-background2)",position:"relative",children:[h&&t.jsx(xt,{}),t.jsx(s,{data:(i==null?void 0:i.items)||[],hasAdminAccess:e,sorting:o,onSortingChange:m=>n(he(m))})]}),t.jsx(S,{display:"flex",width:"100%",justifyContent:"center",marginTop:"18px",children:t.jsx(tt,{totalPages:j,currentPage:a.currentPage,pageSize:a.elementsPerPage,onPageChange:m=>n(je(m)),onPageSizeChange:m=>n(xe(m))})})]})},yt=({rows:e})=>{const[s]=u();return t.jsx(Ae,{children:e.length>0?e.map(a=>t.jsx(F,{children:a.getVisibleCells().map(r=>t.jsx($,{children:Z(r.column.columnDef.cell,r.getContext())},r.id))},a.id)):t.jsx(F,{children:t.jsx($,{colSpan:2e3,textAlign:"center",children:s("domains:projects.errors.no_projects_data")})})})},Pt=e=>e==="asc"?"var(--chakra-colors-brand-accentRed)":"var(--chakra-colors-brand-body)",St=e=>e==="desc"?"var(--chakra-colors-brand-accentRed)":"var(--chakra-colors-brand-body)",_t=({sorting:e})=>t.jsxs(S,{display:"flex",flexDirection:"column",marginLeft:"9px",children:[t.jsx(fe,{size:"10px",color:e?Pt(e):void 0}),t.jsx(Ce,{size:"10px",color:e?St(e):void 0})]}),wt=({headerGroups:e})=>t.jsx(He,{children:e.map(s=>t.jsx(F,{children:s.headers.map(a=>{const r=a.column.getIsSorted(),o=a.column.getCanSort();return t.jsx(ke,{onClick:a.column.getToggleSortingHandler(),whiteSpace:"nowrap",sx:o?{cursor:"pointer",userSelect:"none"}:void 0,children:t.jsxs(S,{display:"flex",alignItems:"center",children:[Z(a.column.columnDef.header,a.getContext()),o&&t.jsx(_t,{sorting:r})]})},a.id)})},s.id))}),Dt=({title:e,titleId:s,...a},r)=>d.createElement("svg",{width:20,height:10,viewBox:"0 0 20 10",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":s,...a},e?d.createElement("title",{id:s},e):null,d.createElement("path",{d:"M15 0H11V2H15C16.65 2 18 3.35 18 5C18 6.65 16.65 8 15 8H11V10H15C17.76 10 20 7.76 20 5C20 2.24 17.76 0 15 0ZM9 8H5C3.35 8 2 6.65 2 5C2 3.35 3.35 2 5 2H9V0H5C2.24 0 0 2.24 0 5C0 7.76 2.24 10 5 10H9V8ZM6 4H14V6H6V4Z",fill:"#646271"}));d.forwardRef(Dt);const Mt="/assets/connect-1825990f.svg",Tt=({title:e,titleId:s,...a},r)=>d.createElement("svg",{width:14,height:18,viewBox:"0 0 14 18",fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:r,"aria-labelledby":s,...a},e?d.createElement("title",{id:s},e):null,d.createElement("path",{d:"M11 6V16H3V6H11ZM9.5 0H4.5L3.5 1H0V3H14V1H10.5L9.5 0ZM13 4H1V16C1 17.1 1.9 18 3 18H11C12.1 18 13 17.1 13 16V4Z",fill:"#646271"}));d.forwardRef(Tt);const At="/assets/delete-9b95ffab.svg",Ht=({getValue:e})=>{const s=e(),[a]=u(),[r,o]=d.useState(!1),n=z(H),i=N(H),[h,{isLoading:j}]=Ye(),m=async()=>{try{await h(s.id),i({description:a("domains:projects.actions.removed_project")}),p()}catch{n({description:a("domains:global.errors.descriptions.unknown_error")})}},p=()=>{o(!1)},x=()=>{o(!0)};return t.jsxs(S,{display:"flex",gap:3,children:[t.jsx(V,{src:Mt,alt:"Connect project",sx:{cursor:"pointer"},onClick:()=>s.id}),t.jsx(G,{hasArrow:!0,place:"top",labelText:a("general_actions:delete"),children:t.jsx(V,{src:At,alt:"Delete project",sx:{cursor:"pointer"},onClick:x})}),t.jsx(be,{title:a("domains:global.confirmations.titles.delete_project"),description:a("domains:global.confirmations.descriptions.delete_project"),onConfirm:m,isOpen:r,onClose:p,isLoading:j})]})},kt=({getValue:e})=>{const[s]=u(),a=e();return a.customer_name?t.jsx(_,{variant:"mm",color:"brand.headline",children:a.customer_name}):t.jsx(_,{color:"brand.lightGray",children:s("domains:employee.errors.no_data")})},Et=({getValue:e})=>{const s=e();return t.jsx(ve,{as:ye,to:`${Pe.Projects}/${s.id}`,children:t.jsx(_,{variant:"mm",color:"brand.headline",children:s.name})},s.id)},Ft=({getValue:e})=>{const s=e(),[a]=u(),r=o=>{switch(o.status){case D.Completed:return"#0077B5";case D.InProgress:return"#56A06B";case D.OnHold:return"#CE9D1E";case D.Wasted:return"#EF4523";default:return"#B3B3B3"}};return t.jsx(S,{display:"flex",justifyContent:"center",alignItems:"center",border:`1px solid ${r(s)}`,borderRadius:"4px",width:"130px",height:"32px",children:t.jsx(_,{variant:"mm",color:"brand.headline",children:a(`domains:projects.status.${s.status}`)})})},Bt=({getValue:e})=>{const[s]=u(),a=e();return a.length?t.jsx(W,{size:"md",max:3,children:a.map(r=>t.jsx(Se,{size:"md",title:`${r.first_name} ${r.last_name}`,src:r.avatar?`https://team-prod.cybergizer.com${r.avatar}`:_e},r.id))}):t.jsx(_,{color:"brand.lightGray",children:s("domains:projects.errors.no_team")})},y=({column:{id:e}})=>{const[s]=u();return t.jsx("span",{children:s(`domains:projects.table_headers.${e}`,{count:100})})},Rt=({getValue:e})=>{const s=e(),[a]=u();return t.jsx(_,{variant:"mm",color:"brand.headline",children:a(`domains:projects.type.${s.project_type}`)})},P=Ee(),It=[P.accessor(e=>e,{id:v.CompanyName,cell:kt,header:y}),P.accessor(e=>e,{id:v.ProjectName,cell:Et,header:y}),P.accessor(e=>e,{id:v.Status,cell:Ft,header:y}),P.accessor(e=>e,{id:v.Type,cell:Rt,header:y}),P.accessor("team",{id:v.Team,cell:Bt,header:y}),P.accessor(e=>e,{id:v.Actions,cell:Ht,header:y})],Ot=({data:e,hasAdminAccess:s,sorting:a,onSortingChange:r})=>{const o=Fe({columns:It,data:e,getCoreRowModel:Re(),manualSorting:!0,onSortingChange:n=>r(typeof n=="function"?n(a):n),initialState:{columnVisibility:{actions:s}},state:{sorting:a}});return t.jsxs(Be,{children:[t.jsx(wt,{headerGroups:o.getHeaderGroups()}),t.jsx(yt,{rows:o.getRowModel().rows})]})},Xt=()=>{const[e]=u(),s=T(we),a=Ie(s),{isOpen:r,onOpen:o,onClose:n}=De();return t.jsx(B,{children:t.jsxs(at,{children:[t.jsx(vt,{table:Ot,hasAdminAccess:a}),r&&t.jsx(gt,{isOpen:r,onClose:n}),t.jsx(et,{drawerControl:t.jsx(jt,{}),drawerContent:t.jsx(ht,{}),action:a?t.jsx(q,{"aria-label":e("domains:projects.actions.add_project"),icon:t.jsx(Me,{}),onClick:o}):void 0})]})})};export{Xt as Projects};
