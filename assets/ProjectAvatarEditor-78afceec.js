import{m as D,n as M}from"./index-82eae258.js";import{bc as j,V as e,aq as _,W as A,b9 as C,ar as x,bd as F,be as l,bf as m,x as p,t as c,B as S,aE as R,X as P,bg as q,bh as O,ag as G}from"./index-7c96dcd7.js";import{i as L,A as Q,f as z,b as H,d as N,e as V,u as U,h as W,E as Y}from"./dates.utils-434c8e9a.js";import{s as E}from"./utils-bd2e33f4.js";const B=j(V),je=e.object({avatar:e.string().or(e.instanceof(File)).superRefine((a,t)=>(a&&!L(a)&&t.addIssue({code:e.ZodIssueCode.custom,message:`File must be one of ${Q.join(", ")} but was ${a instanceof File?a.type:a}`}),null)),customer_name:e.string(),name:e.string().min(1,"required_field"),status:_,project_type:e.string(),started_at:e.object({month:e.string().nullable(),year:e.string().nullable()}).superRefine((a,t)=>(z(a)||t.addIssue({code:e.ZodIssueCode.custom,message:"incorrect_date",path:["month"]}),a)),ended_at:e.object({month:e.string().nullable(),year:e.string().nullable()}).superRefine((a,t)=>(H(a)||t.addIssue({code:e.ZodIssueCode.custom,message:"incorrect_date",path:["month"]}),a)),country_id:e.number().nullable(),business_domain:e.object({value:e.string(),label:e.string()}).nullable(),hard_skill_ids:e.array(e.number()),description:e.string(),challenge:e.string(),solution:e.string()}).refine(a=>N(a.started_at,a.ended_at),{message:"invalid_range",path:["ended_at.month"]}),Z=["in_progress","on_hold","completed","wasted"],X=["external","internal"],J=j(Z),K=j(X),g=e.object({id:e.number(),name:e.string(),status:J,project_type:K,team:e.object({id:e.number(),first_name:e.string(),last_name:e.string(),avatar:e.string().nullable()}).array(),links:e.string().optional(),contractor:e.object({id:e.number(),name:e.string().nullable()}),started_at:e.string().nullable(),ended_at:e.string().nullable()}),ee=e.object({id:e.number(),first_name:e.string(),last_name:e.string(),avatar:e.string().nullable(),status:A.nullable().optional()}),te=e.object({id:e.number(),work_experience_id:e.number(),position_id:e.number().nullable(),start_date:e.string().datetime().nullable(),end_date:e.string().datetime().nullable(),created_at:e.string().datetime().nullable(),updated_at:e.string().datetime().nullable()}),ae=e.object({id:e.number(),name:e.string().nullable(),created_at:e.string().datetime().nullable(),updated_at:e.string().datetime().nullable()}),re=e.object({id:e.number().nullable().optional(),work_experience_positions:te.array(),nowadays:e.boolean(),positions:ae.array()}),se=e.object({id:e.number(),first_name:e.string(),last_name:e.string(),avatar:e.string().nullable(),work_experience:re.array()}),v=e.object({avatar:e.string().nullable().optional(),business_domain:B.nullable(),challenge:e.string().nullable(),contractor:e.object({id:e.number(),name:e.string().nullable()}),country:e.object({id:e.number(),name:e.string()}).nullable(),customer:e.object({id:e.number(),name:e.string()}).nullable(),description:e.string().nullable(),ended_at:e.string().nullable(),hard_skills:e.array(e.object({category:C,id:e.number(),name:e.string()})).nullable(),id:e.number(),managers:ee.array(),name:e.string().nullable(),project_type:x,solution:e.string().nullable(),started_at:e.string().nullable(),status:_,team:se.array()}),oe=e.object({id:e.number(),first_name:e.string(),last_name:e.string(),avatar:e.string().nullable()}),ne=e.object({id:e.number(),name:e.string(),status:_,project_type:x,team:e.array(oe),links:e.string().nullable(),customer_name:e.string().nullable()}),ie=e.object({items:ne.array(),page:e.object({limit:e.number(),offset:e.number(),total_count:e.number()})}),ce=(a,t)=>{Object.keys(t).forEach(s=>{switch(s){case"avatar":{const r=t[s];r&&a.append(s,r);break}case"startDate":{const r=t[s];if(r){const{year:o,month:n}=r,d=E(new Date,{year:o?+o:0,month:n?+n:0});a.append("started_at",d.toISOString())}break}case"endDate":{const r=t[s];if(r){const{year:o,month:n}=r,d=E(new Date,{year:o?+o:0,month:n?+n:0});a.append("ended_at",d.toISOString())}break}case"managers":{const r=t[s];r&&r.forEach(o=>{a.append(`${s}[]`,o.value||"")});break}case"company_name":{const r=t[s];r&&a.append("customer_id",r.value||"");break}default:{const r=t[s];if(r){a.append(s,r);break}}}})},le=F.injectEndpoints({overrideExisting:!1,endpoints:a=>({getProjects:a.query({providesTags:t=>t?[...t.items.map(s=>({type:l.Projects,id:s.id})),{type:l.Projects,id:"LIST"}]:[{type:l.Projects,id:"LIST"}],onQueryStarted:m(t=>ie.safeParse(t)),query:({page:t,elementsPerPage:s})=>({url:"projects",method:"GET",params:new URLSearchParams({items:`${s}`,offset:`${D(t,s)}`,page:t.toString()})})}),getProject:a.query({onQueryStarted:m(t=>v.safeParse(t)),providesTags:t=>[{type:l.Employees,id:`${t?t.id:"ENTITY"}`}],query:t=>({url:`projects/${t}`,method:"GET"})}),updateMainInfo:a.mutation({invalidatesTags:t=>[{type:l.Employees,id:`${t?t.id:"ENTITY"}`}],onQueryStarted:m(t=>v.safeParse(t)),query:({data:t,id:s})=>{const r=new FormData;return Object.entries(t).forEach(([o,n])=>o==="hard_skill_ids"&&n.length===0?r.append(`${o}`,"[]"):o==="hard_skill_ids"&&n?n.forEach(d=>{r.append(`${o}[]`,String(d))}):o==="business_domain"&&n?r.append(o,n.value):o==="avatar"&&n?r.append(o,n):r.append(o,String(n))),{url:`projects/${s}`,method:"PATCH",body:r}}}),createNewProject:a.mutation({invalidatesTags:[{type:l.Projects,id:"LIST"}],onQueryStarted:m(t=>g.safeParse(t)),query:({project:t})=>{const s=new FormData;return ce(s,t),{url:"projects",method:"POST",body:s}}}),addNewEmployee:a.mutation({invalidatesTags:(t,s,r)=>[{type:l.Employees,id:`${r.projectId}`}],onQueryStarted:m(t=>g.safeParse(t)),query:({data:t,projectId:s})=>({url:`projects/${s}/add_team_members`,method:"PATCH",body:t})}),removeProject:a.mutation({invalidatesTags:[{type:l.Projects,id:"LIST"}],query:t=>({url:`projects/${t}`,method:"DELETE"})}),updateProjectsTeam:a.mutation({invalidatesTags:(t,s,r)=>[{type:l.Employees,id:`${r.projectId}`}],onQueryStarted:m(t=>g.safeParse(t)),query:({data:t,projectId:s})=>({url:`projects/${s}/work_experience_positions`,method:"PATCH",body:t})}),removeEmployee:a.mutation({invalidatesTags:(t,s,r)=>[{type:l.Employees,id:`${r.projectId}`}],query:({projectId:t,id:s})=>({url:`projects/${t}/remove_employee`,method:"PATCH",body:{work_experience_positions:{work_experience_id:s}}})}),addManager:a.mutation({invalidatesTags:(t,s,r)=>[{type:l.Employees,id:`${r.projectId}`}],query:({projectId:t,id:s})=>({url:`projects/${t}/project_managers`,method:"PATCH",body:{employee_id:s}})}),removeManager:a.mutation({invalidatesTags:(t,s,r)=>[{type:l.Employees,id:`${r.projectId}`}],query:({projectId:t,id:s})=>({url:`projects/${t}/project_managers`,method:"DELETE",body:{employee_id:s}})})})}),{useGetProjectsQuery:_e,useGetProjectQuery:he,useCreateNewProjectMutation:ye,useRemoveProjectMutation:fe,useRemoveEmployeeMutation:Se,useUpdateProjectsTeamMutation:Pe,useAddNewEmployeeMutation:Ee,useUpdateMainInfoMutation:ve,useAddManagerMutation:Te,useRemoveManagerMutation:xe}=le,T=a=>{switch(a){case"in_progress":return"10px solid var(--chakra-colors-brand-accentGreen)";case"on_hold":return"10px solid var(--chakra-colors-brand-accentYellow)";case"wasted":return"10px solid var(--chakra-colors-brand-ghostGray)";case"completed":return"10px solid var(--chakra-colors-brand-accentBlue)";default:return"2px solid var(--chakra-colors-brand-stroke)"}},de=[255,255,255,.6],Ie=({avatar:a,onAvatarChanged:t,onReset:s,status:r,avatarUrl:o})=>{const[n,d]=p.useState(1),[u,b]=p.useState(null),h=p.useRef(null);p.useEffect(()=>{a||(b(a),d(1))},[a,u]);const y=p.useMemo(()=>M(async()=>{const{current:i}=h;if(i){const k=i.getImageScaledToCanvas().toDataURL(),f=await(await fetch(k)).blob();t(new File([f],u.name||"employee_avatar",{type:f.type}))}},500),[t,u]),{getRootProps:I,getInputProps:w,inputRef:$}=U({maxFiles:1,onDrop:([i])=>{i&&(b(i),d(1),t(i))}});return c.jsxs(S,{children:[c.jsxs(S,{children:[u?c.jsx(W,{ref:h,image:u,onImageChange:y,onImageReady:y,width:250,height:250,border:0,color:de,scale:n,crossOrigin:"anonymous",borderRadius:0,style:{border:`${T(r)}`}}):c.jsx(R,{src:o?`https://team-prod.cybergizer.com${o}`:void 0,_hover:{div:{opacity:1}},size:"lg",cursor:"pointer",borderRadius:0,style:{border:`${T(r)}`},children:c.jsx(P,{borderRadius:"5px",border:"1px solid var(--chakra-colors-brand-stroke)",bgColor:"#FFFFFF",cursor:"pointer",sx:{position:"absolute",opacity:0},children:c.jsx(P,{...I({onClick:i=>{u&&i.stopPropagation()}}),children:o!=="null"?c.jsxs(c.Fragment,{children:[c.jsx(q,{id:"EditAvatarIcon",size:50,color:"var(--chakra-colors-brand-ghostGray)"}),c.jsx(O,{id:"DeleteAvatarIcon",size:50,color:"var(--chakra-colors-brand-ghostGray)",onClick:i=>{i.stopPropagation(),t("null")}})]}):c.jsx(G,{id:"AddAvatarIcon",size:64,color:"var(--chakra-colors-brand-ghostGray)"})})})}),c.jsx("input",{...w()})]}),u&&c.jsx(Y,{onEdit:()=>{var i;return(i=$.current)==null?void 0:i.click()},scale:n,onScaleChange:d,onDelete:i=>{s(i),b(null),d(1)}})]})};export{Ie as P,_e as a,fe as b,T as c,ve as d,je as e,Te as f,xe as g,Pe as h,Se as i,Ee as j,he as k,ye as u};
